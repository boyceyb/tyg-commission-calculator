<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TYG Commission Tracker</title>
    <style>
        :root {
            --primary-blue: #2563eb;
            --primary-green: #16a34a;
            --success-green: #22c55e;
            --warning-yellow: #eab308;
            --error-red: #dc2626;
            --text-primary: #111827;
            --text-secondary: #6b7280;
            --text-muted: #9ca3af;
            --bg-primary: #f9fafb;
            --bg-card: #ffffff;
            --border-light: #e5e7eb;
            --border-medium: #d1d5db;
            --shadow-light: 0 1px 3px rgba(0,0,0,0.1);
            --shadow-medium: 0 4px 6px rgba(0,0,0,0.1);
            --shadow-hover: 0 10px 15px rgba(0,0,0,0.1);
        }

        * { 
            margin: 0; 
            padding: 0; 
            box-sizing: border-box; 
        }
        
        body { 
            font-family: 'Inter', 'Helvetica Neue', 'Arial', sans-serif; 
            background: var(--bg-primary); 
            min-height: 100vh;
            padding: 24px; 
            color: var(--text-primary); 
            line-height: 1.5;
            margin: 0;
            overflow-x: hidden;
        }
        
        .container { 
            max-width: 1200px; 
            margin: 0 auto; 
            position: relative;
        }

        .sticky-header {
            position: sticky;
            top: 16px;
            z-index: 100;
            background: rgba(255, 255, 255, 0.98);
            border-radius: 8px;
            padding: 12px 20px;
            margin-bottom: 24px;
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.1);
            border: 1px solid #e2e8f0;
            backdrop-filter: blur(12px);
        }

        .sticky-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 24px;
            flex-wrap: wrap;
        }

        .sticky-title {
            color: #475569;
            font-size: 16px;
            font-weight: 600;
            letter-spacing: -0.025em;
            min-width: 140px;
        }

        .sticky-controls {
            display: flex;
            gap: 16px;
            align-items: center;
        }

        .header-toggle {
            display: flex;
            align-items: center;
            gap: 8px;
            position: relative;
        }

        .header-toggle[data-tooltip] {
            cursor: help;
        }

        .header-toggle[data-tooltip]:hover::after,
        .header-toggle[data-tooltip].tooltip-active::after {
            content: attr(data-tooltip);
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            margin-top: 8px;
            padding: 12px 16px;
            background: rgba(30, 41, 59, 0.95);
            color: white;
            font-size: 12px;
            font-weight: 400;
            line-height: 1.4;
            border-radius: 8px;
            white-space: normal;
            min-width: 220px;
            max-width: 320px;
            text-align: left;
            z-index: 1000;
            opacity: 0;
            animation: tooltipFadeIn 0.2s ease forwards;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            backdrop-filter: blur(8px);
            pointer-events: none;
        }

        .header-toggle[data-tooltip]:hover::before,
        .header-toggle[data-tooltip].tooltip-active::before {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            margin-top: 2px;
            width: 0;
            height: 0;
            border-left: 6px solid transparent;
            border-right: 6px solid transparent;
            border-bottom: 6px solid rgba(30, 41, 59, 0.95);
            z-index: 1001;
            opacity: 0;
            animation: tooltipFadeIn 0.2s ease forwards;
            pointer-events: none;
        }

        @keyframes tooltipFadeIn {
            from {
                opacity: 0;
                transform: translateX(-50%) translateY(-4px);
            }
            to {
                opacity: 1;
                transform: translateX(-50%) translateY(0);
            }
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .header-toggle-input {
            display: none;
        }

        .header-toggle-label {
            position: relative;
            display: flex;
            align-items: center;
            cursor: pointer;
            width: 36px;
            height: 20px;
        }

        .header-toggle-slider {
            position: absolute;
            width: 36px;
            height: 20px;
            background: #cbd5e1;
            border-radius: 10px;
            display: flex;
            align-items: center;
            padding: 2px;
        }

        .header-toggle-slider::after {
            content: '';
            position: absolute;
            width: 16px;
            height: 16px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
            transform: translateX(0);
            transition: transform 0.3s;
        }

        .header-toggle-input:checked + .header-toggle-label .header-toggle-slider {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
        }

        .header-toggle-input:checked + .header-toggle-label .header-toggle-slider::after {
            transform: translateX(16px);
        }

        .header-toggle-text {
            font-size: 12px;
            font-weight: 500;
            color: #64748b;
            white-space: nowrap;
        }

        .header-toggle-input:checked ~ .header-toggle-text {
            color: #1d4ed8;
            font-weight: 600;
        }

        .header-toggle.disabled {
            opacity: 0.5;
            pointer-events: none;
        }

        .header-toggle.disabled .header-toggle-slider {
            background: #e2e2e2;
        }

        .header-toggle.disabled .header-toggle-text {
            color: #999;
        }

        .sticky-metrics {
            display: flex;
            gap: 24px;
            align-items: center;
            flex: 1;
            justify-content: flex-end;
        }

        .sticky-metric {
            text-align: center;
            padding: 8px 16px;
            background: #f8fafc;
            border-radius: 6px;
            border: 1px solid #e2e8f0;
            min-width: 120px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .sticky-metric:hover {
            background: #f1f5f9;
            border-color: #cbd5e1;
        }

        .sticky-metric-label {
            display: block;
            font-size: 10px;
            font-weight: 500;
            color: #64748b;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 3px;
        }

        .sticky-metric-value {
            display: block;
            font-size: 15px;
            font-weight: 600;
            color: #1e293b;
            letter-spacing: -0.025em;
        }

        .sticky-metric.commission .sticky-metric-value {
            color: #3b82f6;
        }

        .sticky-metric.earnings .sticky-metric-value {
            color: #10b981;
        }

        .sticky-metric.seniority .sticky-metric-value {
            color: #8b5cf6;
            font-size: 13px;
            font-weight: 600;
            position: relative;
            transition: all 0.3s ease;
        }

        /* Dynamic Level Colors */
        .sticky-metric.seniority.consultant .sticky-metric-value {
            color: #10b981;
        }

        .sticky-metric.seniority.consultant-ii .sticky-metric-value {
            color: #3b82f6;
        }

        .sticky-metric.seniority.senior .sticky-metric-value {
            color: #f59e0b;
        }

        .sticky-metric.seniority.principal .sticky-metric-value {
            color: #8b5cf6;
        }
        
        .grid { 
            display: grid; 
            grid-template-columns: 1fr 1fr; 
            gap: 32px; 
        }
        
        .card { 
            background: var(--bg-card); 
            box-shadow: var(--shadow-light); 
            padding: 32px; 
            border-radius: 8px;
            border: 1px solid var(--border-light);
            transition: box-shadow 0.2s ease;
        }

        .card:hover { 
            box-shadow: var(--shadow-medium); 
        }
        
        .card h3 { 
            font-size: 16px; 
            font-weight: 600; 
            margin-bottom: 24px; 
            color: var(--text-primary); 
            display: flex; 
            align-items: center; 
            gap: 8px; 
            letter-spacing: -0.025em;
            padding-bottom: 12px;
            border-bottom: 1px solid var(--border-light);
        }
        
        .input-group { 
            margin-bottom: 24px; 
        }
        
        .input-group label { 
            display: block; 
            font-size: 13px; 
            font-weight: 600; 
            color: var(--text-secondary); 
            margin-bottom: 8px; 
            letter-spacing: 0.3px;
            transition: color 0.2s ease;
        }
        
        .input-group input, .input-group select { 
            width: 100%; 
            padding: 12px 16px; 
            border: 1px solid var(--border-medium); 
            border-radius: 6px;
            font-size: 14px; 
            background: var(--bg-card); 
            transition: border-color 0.2s ease, box-shadow 0.2s ease; 
            font-weight: 400;
            color: var(--text-primary);
            font-family: inherit;
        }

        input[type="number"]::-webkit-outer-spin-button,
        input[type="number"]::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        input[type="number"] {
            -moz-appearance: textfield;
        }
        
        .input-group input:focus, .input-group select:focus { 
            outline: none; 
            border-color: var(--primary-blue); 
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }
        
        .input-group:focus-within label {
            color: var(--primary-blue);
            transform: translateY(-1px);
        }
        
        .input-group small { 
            font-size: 12px; 
            color: var(--text-muted); 
            margin-top: 6px; 
            display: block; 
            font-weight: 400;
            line-height: 1.4;
            transition: color 0.2s ease;
        }

        .input-group:focus-within small {
            color: var(--text-secondary);
        }

        /* Billing Tracker Section */
        .billing-section {
            background: white;
            margin-bottom: 24px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            overflow: hidden;
            border: 1px solid #e2e8f0;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .billing-section:hover {
            box-shadow: 0 8px 25px rgba(0,0,0,0.12);
            transform: translateY(-1px);
        }

        .billing-header {
            background: #f8fafc;
            padding: 20px 24px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: 600;
            color: #1e293b;
            border-bottom: 1px solid #e2e8f0;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .billing-header:hover {
            background: #f1f5f9;
            color: var(--primary-blue);
        }

        .billing-header.active {
            background: #1e293b;
            color: white;
        }

        .dropdown-arrow {
            font-size: 14px;
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .dropdown-arrow.rotated {
            transform: rotate(180deg);
        }

        .billing-panel {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            background: #fafbfc;
        }

        .billing-panel.open {
            max-height: 600px;
        }

        .billing-content {
            padding: 20px;
        }

        .add-billing-section {
            display: flex;
            gap: 12px;
            margin-bottom: 20px;
            background: white;
            padding: 16px;
            border-radius: 8px;
            border: 1px solid #e2e8f0;
        }

        .billing-value-input {
            flex: 1;
        }

        .billing-value-input input {
            width: 100%;
            padding: 10px 14px;
            border: 2px solid #e2e8f0;
            border-radius: 6px;
            font-size: 14px;
            transition: all 0.2s ease;
        }

        .billing-value-input input:focus {
            outline: none;
            border-color: var(--primary-blue);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .period-select {
            min-width: 160px;
        }

        .period-select select {
            width: 100%;
            padding: 10px 14px;
            border: 2px solid #e2e8f0;
            border-radius: 6px;
            font-size: 14px;
            background: white;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .period-select select:focus {
            outline: none;
            border-color: var(--primary-blue);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .billing-add-button {
            flex-shrink: 0;
        }

        .billing-add-button .btn {
            padding: 10px 20px;
            font-size: 14px;
            height: 100%;
        }

        .billings-list {
            display: grid;
            gap: 8px;
            margin-bottom: 20px;
            max-height: 240px;
            overflow-y: auto;
            padding-right: 4px;
        }

        .billings-list::-webkit-scrollbar {
            width: 6px;
        }

        .billings-list::-webkit-scrollbar-track {
            background: #f1f5f9;
            border-radius: 3px;
        }

        .billings-list::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 3px;
        }

        .billings-list::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }

        .billing-item {
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            padding: 12px 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.2s ease;
            position: relative;
        }

        .billing-item::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 3px;
            background: #cbd5e1;
            border-radius: 6px 0 0 6px;
            transition: all 0.2s ease;
        }

        .billing-item:hover {
            border-color: #cbd5e1;
            background: #f8fafc;
        }

        .billing-item:hover::before {
            background: var(--primary-blue);
        }

        .billing-info {
            display: flex;
            align-items: center;
            gap: 24px;
            flex: 1;
        }

        .billing-number {
            font-size: 12px;
            font-weight: 600;
            color: #94a3b8;
            min-width: 40px;
        }

        .billing-value {
            font-size: 16px;
            font-weight: 600;
            color: #1e293b;
        }

        .billing-period {
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
        }

        .billing-period.early {
            background: #dcfce7;
            color: #166534;
        }

        .billing-period.late {
            background: #fef3c7;
            color: #92400e;
        }

        .billing-commission {
            font-size: 14px;
            color: #059669;
            font-weight: 500;
        }

        .billing-remove {
            background: transparent;
            border: none;
            color: #94a3b8;
            padding: 4px 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 18px;
            line-height: 1;
        }

        .billing-remove:hover {
            color: #dc2626;
            transform: scale(1.1);
        }

        .billing-remove:active {
            transform: scale(0.9);
        }

        .billings-summary {
            background: linear-gradient(135deg, #f0f9ff, #e0f2fe);
            border: 1px solid #bae6fd;
            border-radius: 8px;
            padding: 16px;
        }

        .summary-stats {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 16px;
        }

        .summary-stat {
            text-align: center;
        }

        .summary-stat-label {
            font-size: 11px;
            color: #64748b;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 4px;
        }

        .summary-stat-value {
            font-size: 18px;
            font-weight: 700;
            color: #0c4a6e;
        }

        /* Breakdown */
        .breakdown { 
            background: #f8fafc; 
            padding: 16px; 
            border-radius: 8px; 
            border: 1px solid #e2e8f0; 
            margin-bottom: 16px;
            transition: all 0.3s ease;
        }

        .breakdown:hover {
            background: #f1f5f9;
            border-color: #cbd5e1;
        }
        
        .breakdown h4 { 
            font-size: 15px; 
            font-weight: 600; 
            color: #374151; 
            margin-bottom: 12px; 
        }
        
        .breakdown-item { 
            display: flex; 
            justify-content: space-between; 
            align-items: flex-start; 
            font-size: 14px; 
            margin-bottom: 8px; 
            padding: 6px 0;
            border-bottom: 1px solid #f1f5f9;
            transition: all 0.2s ease;
        }

        .breakdown-item:hover {
            background: rgba(59, 130, 246, 0.05);
            border-radius: 4px;
            padding: 8px 12px;
            margin: 0 -12px 12px -12px;
        }
        
        .breakdown-item:last-child { 
            border-bottom: none; 
            margin-bottom: 0; 
        }
        
        .breakdown-left { 
            color: #64748b; 
            flex: 1; 
            font-weight: 500;
        }
        
        .breakdown-right { 
            font-weight: 600; 
            color: #1e293b; 
            margin-left: 16px; 
        }

        .breakdown-promotion-divider {
            position: relative;
            margin: 16px -8px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .breakdown-promotion-divider::before {
            content: '';
            position: absolute;
            left: 0;
            right: 0;
            height: 1px;
            background: #d1d5db;
            z-index: 1;
        }

        .promotion-indicator {
            background: #f9fafb;
            padding: 4px 12px;
            font-size: 11px;
            color: #64748b;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            position: relative;
            z-index: 2;
            border-radius: 12px;
            border: 1px solid #e2e8f0;
        }
        
        /* Earnings */
        .earnings-item { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            margin-bottom: 8px; 
            font-size: 16px; 
            padding: 12px 0;
            border-bottom: 1px solid var(--border-light);
            transition: all 0.2s ease;
        }

        .earnings-item:hover {
            padding: 16px 12px;
            margin: 0 -12px 16px -12px;
            background: rgba(59, 130, 246, 0.03);
            border-radius: 8px;
        }
        
        .earnings-item:last-child { 
            margin-bottom: 0; 
            padding: 20px; 
            margin: 16px -20px 0 -20px;
            border: none;
            background: linear-gradient(135deg, var(--text-primary), #404040);
            border-radius: 8px;
            font-size: 18px; 
            font-weight: 600; 
            color: white !important;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .earnings-item:last-child:hover {
            transform: scale(1.02);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }
        
        .earnings-label { 
            color: var(--text-secondary); 
            font-weight: 500;
            font-size: 13px;
            letter-spacing: 0.3px;
            text-transform: uppercase;
            transition: color 0.2s ease;
        }
        
        .earnings-value { 
            font-weight: 600; 
            letter-spacing: -0.3px;
            color: var(--text-primary);
            font-size: 18px;
            transition: all 0.3s ease;
        }

        .earnings-item:hover .earnings-value {
            transform: scale(1.05);
        }
        
        .earnings-value.commission { 
            color: var(--primary-blue); 
        }
        .earnings-value.salary { 
            color: var(--text-secondary); 
        }
        .earnings-value.team { 
            color: var(--primary-green); 
        }
        
        .earnings-item:last-child .earnings-label { 
            color: #e2e8f0 !important; 
            font-size: 12px;
            font-weight: 600;
            letter-spacing: 0.5px;
        }
        
        .earnings-item:last-child .earnings-value { 
            font-size: 24px !important; 
            font-weight: 700 !important;
            color: #4ade80 !important;
            letter-spacing: -0.5px;
        }
        
        /* Status */
        .status-compact {
            padding: 12px 16px;
            border-radius: 6px;
            margin-bottom: 16px;
            border: 1px solid;
            font-size: 13px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .status-compact:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        }

        .status-compact.success {
            background: #f0fdf4;
            border-color: #bbf7d0;
        }

        .status-compact.success:hover {
            background: #dcfce7;
        }

        .status-compact.info {
            background: #eff6ff;
            border-color: #bfdbfe;
        }

        .status-compact.info:hover {
            background: #dbeafe;
        }

        .status-compact.error {
            background: #fef2f2;
            border-color: #fecaca;
        }

        .status-compact.error:hover {
            background: #fee2e2;
        }

        .status-compact .status-title {
            font-weight: 600;
            margin-bottom: 4px;
            font-size: 13px;
        }

        .status-compact.success .status-title { color: #166534; }
        .status-compact.info .status-title { color: #1d4ed8; }
        .status-compact.error .status-title { color: #dc2626; }

        .status-compact .status-text {
            font-size: 12px;
            color: #64748b;
            line-height: 1.4;
        }
        
        .status { 
            padding: 18px; 
            border-radius: 8px; 
            margin-bottom: 20px; 
            border: 1px solid;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .status:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        .status.success { 
            background: #f0fdf4; 
            border-color: #bbf7d0; 
        }

        .status.success:hover {
            background: #dcfce7;
        }
        
        .status.error { 
            background: #fef2f2; 
            border-color: #fecaca; 
        }

        .status.error:hover {
            background: #fee2e2;
        }
        
        .status.info { 
            background: #eff6ff; 
            border-color: #bfdbfe; 
        }

        .status.info:hover {
            background: #dbeafe;
        }
        
        .status-title { 
            font-weight: 600; 
            margin-bottom: 6px; 
            font-size: 15px; 
        }
        
        .status.success .status-title { color: #166534; }
        .status.error .status-title { color: #dc2626; }
        .status.info .status-title { color: #1d4ed8; }
        
        .status-text { 
            font-size: 14px; 
            color: #64748b; 
            line-height: 1.5;
        }

        /* Promotion Progress */
        .progress-container { 
            margin-bottom: 20px; 
        }
        
        .progress-header { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            margin-bottom: 10px; 
        }
        
        .progress-label { 
            font-size: 15px; 
            font-weight: 600; 
            color: #374151; 
        }
        
        .progress-type { 
            font-size: 13px; 
            color: #64748b; 
            font-weight: 600;
        }
        
        .progress-bar { 
            width: 100%; 
            height: 8px; 
            background: #e5e7eb; 
            border-radius: 4px; 
            overflow: hidden;
        }
        
        .progress-fill { 
            height: 100%; 
            background: var(--primary-blue); 
            transition: width 0.6s ease;
        }
        
        .progress-stats { 
            display: flex; 
            justify-content: space-between; 
            font-size: 12px; 
            color: #64748b; 
            margin-top: 6px; 
        }

        .promotion-badge { 
            background: #dcfce7; 
            color: #166534; 
            padding: 16px 20px; 
            border-radius: 8px; 
            margin-bottom: 20px; 
            border: 1px solid #bbf7d0;
            transition: all 0.3s ease;
        }

        .promotion-badge:hover {
            transform: scale(1.02);
            box-shadow: 0 4px 12px rgba(34, 197, 94, 0.2);
        }
        
        .promotion-badge h4 { 
            font-weight: 600; 
            margin-bottom: 6px; 
            font-size: 15px;
        }
        
        .early-promotion-badge { 
            background: #fef3c7; 
            color: #92400e; 
            padding: 16px 20px; 
            border-radius: 8px; 
            margin-bottom: 20px; 
            border: 1px solid #fcd34d;
            transition: all 0.3s ease;
        }

        .early-promotion-badge:hover {
            transform: scale(1.02);
            box-shadow: 0 4px 12px rgba(245, 158, 11, 0.2);
        }
        
        .early-promotion-badge h4 { 
            font-weight: 600; 
            margin-bottom: 6px; 
            color: #92400e; 
            font-size: 15px;
        }

        /* Info Section */
        .info-section {
            background: white;
            margin-bottom: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            overflow: hidden;
            border: 1px solid #e2e8f0;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .info-section:hover {
            box-shadow: 0 6px 20px rgba(0,0,0,0.1);
            transform: translateY(-1px);
        }

        .info-header {
            background: #f8fafc;
            padding: 16px 20px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: 600;
            color: #1e293b;
            border-bottom: 1px solid #e2e8f0;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .info-header:hover {
            background: #f1f5f9;
            color: var(--primary-blue);
        }

        .info-header.active {
            background: #1e293b;
            color: white;
        }

        .info-panel {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            background: #fafbfc;
        }

        .info-panel.open {
            max-height: 2000px;
        }

        /* Level Cards */
        .levels-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 16px;
            margin: 20px;
            padding-top: 12px;
        }

        .level-card {
            background: #ffffff;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 3px 15px rgba(0, 0, 0, 0.06);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: 1px solid #f1f5f9;
            position: relative;
        }

        .level-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }

        .level-card.consultant {
            border-top: 3px solid #10b981;
        }

        .level-card.consultant-ii {
            border-top: 3px solid #3b82f6;
        }

        .level-card.senior {
            border-top: 3px solid #f59e0b;
        }

        .level-card.principal {
            border-top: 3px solid #8b5cf6;
        }

        .level-header {
            padding: 16px 16px 12px 16px;
            background: #fafbfc;
            border-bottom: 1px solid #f1f5f9;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            gap: 12px;
        }

        .level-header h4 {
            margin: 0;
            font-size: 16px;
            font-weight: 700;
            color: #1e293b;
            letter-spacing: -0.025em;
            line-height: 1.2;
            flex: 1;
        }

        .level-badge {
            padding: 4px 8px;
            border-radius: 16px;
            font-size: 10px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.3px;
            border: none;
            white-space: nowrap;
            flex-shrink: 0;
        }

        .level-card.consultant .level-badge {
            background: linear-gradient(135deg, #d1fae5, #a7f3d0);
            color: #065f46;
        }

        .level-card.consultant-ii .level-badge {
            background: linear-gradient(135deg, #dbeafe, #bfdbfe);
            color: #1e40af;
        }

        .level-card.senior .level-badge {
            background: linear-gradient(135deg, #fef3c7, #fed7aa);
            color: #92400e;
        }

        .level-card.principal .level-badge {
            background: linear-gradient(135deg, #f3e8ff, #e9d5ff);
            color: #6b21a8;
        }

        .level-content {
            padding: 16px;
        }

        .level-metrics {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 16px;
        }

        .metric-card {
            background: #f8fafc;
            border-radius: 8px;
            padding: 12px;
            text-align: center;
            border: 1px solid #e2e8f0;
            transition: all 0.2s ease;
        }

        .metric-card:hover {
            background: #f1f5f9;
            transform: translateY(-1px);
        }

        .metric-label {
            font-size: 10px;
            font-weight: 600;
            color: #64748b;
            text-transform: uppercase;
            letter-spacing: 0.3px;
            margin-bottom: 4px;
        }

        .metric-value {
            font-size: 16px;
            font-weight: 700;
            color: #1e293b;
        }
        
        /* Buttons */
        .btn { 
            border: none; 
            padding: 12px 20px; 
            border-radius: 6px; 
            font-size: 14px; 
            font-weight: 500; 
            cursor: pointer; 
            transition: background-color 0.2s ease, box-shadow 0.2s ease; 
            width: 100%; 
            font-family: inherit;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .btn:hover { 
            box-shadow: var(--shadow-medium);
        }

        .btn:active {
            transform: translateY(1px);
        }

        .btn-primary {
            background: var(--primary-blue);
            color: white;
        }

        .btn-primary:hover {
            background: #1d4ed8;
        }
        
        .hidden { 
            display: none !important; 
        }

        .disabled {
            opacity: 0.5;
            pointer-events: none;
            background: #f5f5f5;
            transition: opacity 0.3s ease;
        }

        .add-billing-section.fast-track {
            grid-template-columns: 1fr auto;
        }

        @media (max-width: 768px) { 
            .grid { 
                grid-template-columns: 1fr; 
            } 
            .card { 
                padding: 24px; 
            }
            .container { 
                padding: 16px; 
            }

            .sticky-header {
                margin-bottom: 20px;
                border-radius: 8px;
                padding: 8px 16px;
                background: rgba(255, 255, 255, 0.98);
                backdrop-filter: blur(8px);
                box-shadow: 0 1px 6px rgba(0, 0, 0, 0.1);
                top: 8px;
            }

            .sticky-content {
                flex-direction: column;
                gap: 8px;
                text-align: center;
            }

            .sticky-title {
                font-size: 13px;
                margin-bottom: 0;
                min-width: auto;
                order: 1;
            }

            .sticky-controls {
                gap: 16px;
                order: 2;
                justify-content: center;
            }

            .sticky-metrics {
                gap: 6px;
                flex-direction: row;
                flex-wrap: wrap;
                justify-content: center;
                order: 3;
            }

            .sticky-metric {
                min-width: auto;
                flex: 1;
                min-width: 80px;
                padding: 8px 12px;
            }

            .sticky-metric-value {
                font-size: 13px;
            }

            .sticky-metric-label {
                font-size: 9px;
            }

            .add-billing-section {
                flex-direction: column;
                gap: 12px;
            }
            
            .add-billing-section.fast-track {
                flex-direction: column;
            }

            .billing-value-input,
            .period-select,
            .billing-add-button {
                width: 100%;
            }

            .summary-stats {
                grid-template-columns: 1fr;
                gap: 12px;
            }
            
            .billing-panel.open {
                max-height: 1000px;
            }

            .levels-grid {
                grid-template-columns: 1fr;
                gap: 12px;
                margin: 16px 12px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="sticky-header" id="stickyHeader">
            <div class="sticky-content">
                <div class="sticky-title">TYG Commission Tracker</div>
                <div class="sticky-controls">
                    <div class="header-toggle" data-tooltip="Year 1 accelerated promotion path available for Consultants only">
                        <input type="checkbox" id="fastTrackToggle" class="header-toggle-input">
                        <label for="fastTrackToggle" class="header-toggle-label">
                            <span class="header-toggle-slider"></span>
                        </label>
                        <span class="header-toggle-text">Year 1 Fast-Track</span>
                    </div>
                </div>
                <div class="sticky-metrics">
                    <div class="sticky-metric billings">
                        <span class="sticky-metric-label">Total Billings</span>
                        <span class="sticky-metric-value" id="stickyBillings">£0</span>
                    </div>
                    <div class="sticky-metric commission">
                        <span class="sticky-metric-label">Commission</span>
                        <span class="sticky-metric-value" id="stickyCommission">£0</span>
                    </div>
                    <div class="sticky-metric seniority consultant">
                        <span class="sticky-metric-label">Current Level</span>
                        <span class="sticky-metric-value" id="stickySeniority">Consultant</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="grid">
            <div class="card">
                <div class="input-group">
                    <label>Starting Level for This Commission Year</label>
                    <select id="currentLevel">
                        <option value="Consultant">Consultant</option>
                        <option value="Consultant II">Consultant II</option>
                        <option value="Senior Consultant">Senior Consultant</option>
                        <option value="Principal Consultant">Principal Consultant</option>
                    </select>
                    <small>Select your level at the start of your personal commission year (not calendar year)</small>
                </div>
                
                <div id="teamSection" class="hidden">
                    <div class="input-group">
                        <label>Team Annual Billings (£) ⓘ</label>
                        <input type="number" id="teamBillings" placeholder="Team annual billings (£)" min="0" step="1000">
                        <small>10% commission applies to team billings for Principal level</small>
                    </div>
                </div>
                
                <div class="input-group">
                    <label>Base Salary (£) - Optional</label>
                    <input type="number" id="baseSalary" placeholder="Enter your annual base salary in £..." min="0" step="1000">
                    <small>Include for total earnings calculation</small>
                </div>
                
                <div class="billing-section">
                    <div class="billing-header" onclick="toggleBillings()">
                        <span>Billing Tracker</span>
                        <span class="dropdown-arrow" id="billingsArrow">▼</span>
                    </div>
                    <div class="billing-panel" id="billingsPanel">
                        <div class="billing-content">
                            <div class="add-billing-section">
                                <div class="billing-value-input">
                                    <input type="number" id="billingValue" placeholder="Enter deal value or total billings..." min="0" step="1000">
                                </div>
                                <div class="period-select">
                                    <select id="billingPeriod">
                                        <option value="early">First 6 months</option>
                                        <option value="late">After 6 months</option>
                                    </select>
                                </div>
                                <div class="billing-add-button">
                                    <button class="btn btn-primary" onclick="addBilling()">Add</button>
                                </div>
                            </div>
                            
                            <div class="billings-list" id="billingsList">
                                <!-- Billings will be populated here -->
                            </div>
                            
                            <div class="billings-summary hidden" id="billingsSummary">
                                <div class="summary-stats">
                                    <div class="summary-stat">
                                        <div class="summary-stat-label">Billings</div>
                                        <div class="summary-stat-value" id="totalBillings">0</div>
                                    </div>
                                    <div class="summary-stat">
                                        <div class="summary-stat-label">Total Value</div>
                                        <div class="summary-stat-value" id="totalBillingsValue">£0</div>
                                    </div>
                                    <div class="summary-stat">
                                        <div class="summary-stat-label">Est. Commission</div>
                                        <div class="summary-stat-value" id="totalCommission">£0</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                

            </div>
            
            <div class="card">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px; padding-bottom: 16px; border-bottom: 1px solid var(--border-light);">
                    <h3 style="margin: 0;">Earnings Summary</h3>
                </div>
                
                <div id="emptyState" class="status info">
                    <div class="status-title">Commission Thresholds</div>
                    <div class="status-text">
                        <strong>Consultant:</strong> £35,000 minimum to earn commission<br>
                        <strong>All other levels:</strong> £40,000 minimum to earn commission<br><br>
                        Enter your billings to see detailed calculations.
                    </div>
                </div>
                
                <div id="calculationResults" class="hidden">
                    <div id="thresholdStatus" class="status-compact">
                        <div class="status-title" id="statusTitle">Threshold Status</div>
                        <div class="status-text" id="statusText">Checking threshold requirements...</div>
                    </div>
                    
                    <div id="breakdown" class="breakdown hidden">
                        <h4>Commission Breakdown</h4>
                        <div id="breakdownItems"></div>
                    </div>
                    
                    <div class="earnings-item" id="commissionRow">
                        <span class="earnings-label">Commission Earned</span>
                        <span class="earnings-value commission" id="commissionValue">£0</span>
                    </div>
                    
                    <div class="earnings-item hidden" id="salaryRow">
                        <span class="earnings-label">Base Salary</span>
                        <span class="earnings-value salary" id="salaryValue">£0</span>
                    </div>
                    
                    <div class="earnings-item hidden" id="teamBonusRow">
                        <span class="earnings-label">Team Bonus (10%)</span>
                        <span class="earnings-value team" id="teamBonusValue">£0</span>
                    </div>
                    
                    <div class="earnings-item hidden" id="totalRow">
                        <span class="earnings-label">Total Annual Earnings</span>
                        <span class="earnings-value" id="totalEarningsValue">£0</span>
                    </div>
                    
                    <div id="promotionProgress" class="hidden">
                        <h3 style="margin-top: 24px; margin-bottom: 16px;">Promotion Progress</h3>
                        <div id="promotionContent"></div>
                    </div>
                </div>
            </div>
        </div>

        <div class="info-section">
            <div class="info-header" onclick="toggleLevels()">
                <span>Seniority Levels & Commission Structure</span>
                <span class="dropdown-arrow" id="levelsArrow">▼</span>
            </div>
            <div class="info-panel" id="levelsPanel">
                <div class="levels-grid">
                    <div class="level-card consultant">
                        <div class="level-header">
                            <h4>Consultant</h4>
                            <div class="level-badge">Starting Level</div>
                        </div>
                        <div class="level-content">
                            <div class="level-metrics">
                                <div class="metric-card">
                                    <div class="metric-label">Threshold</div>
                                    <div class="metric-value">£35,000</div>
                                </div>
                                <div class="metric-card">
                                    <div class="metric-label">Commission</div>
                                    <div class="metric-value">20%</div>
                                </div>
                            </div>
                            
                            <div class="promotion-paths" style="margin-top: 14px;">
                                <div class="promotion-section" style="margin-bottom: 12px;">
                                    <div class="promotion-title" style="font-size: 10px; font-weight: 600; color: #475569; margin-bottom: 6px; text-transform: uppercase; letter-spacing: 0.3px;">Fast-Track (Year 1)</div>
                                    <div class="promotion-list" style="display: flex; flex-direction: column; gap: 4px;">
                                        <div class="promotion-item" style="background: white; padding: 8px 10px; border-radius: 6px; border: 1px solid #e2e8f0; font-size: 11px; font-weight: 500; color: #64748b;">£100k → Consultant II</div>
                                        <div class="promotion-item" style="background: white; padding: 8px 10px; border-radius: 6px; border: 1px solid #e2e8f0; font-size: 11px; font-weight: 500; color: #64748b;">£140k → Senior</div>
                                        <div class="promotion-item" style="background: white; padding: 8px 10px; border-radius: 6px; border: 1px solid #e2e8f0; font-size: 11px; font-weight: 500; color: #64748b;">£180k → Principal</div>
                                    </div>
                                </div>
                                <div class="promotion-section">
                                    <div class="promotion-title" style="font-size: 10px; font-weight: 600; color: #475569; margin-bottom: 6px; text-transform: uppercase; letter-spacing: 0.3px;">Standard Path</div>
                                    <div class="promotion-list" style="display: flex; flex-direction: column; gap: 4px;">
                                        <div class="promotion-item" style="background: white; padding: 8px 10px; border-radius: 6px; border: 1px solid #e2e8f0; font-size: 11px; font-weight: 500; color: #64748b;">£96k → Senior (Early)</div>
                                        <div class="promotion-item" style="background: white; padding: 8px 10px; border-radius: 6px; border: 1px solid #e2e8f0; font-size: 11px; font-weight: 500; color: #64748b;">£160k → Senior</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="level-card consultant-ii">
                        <div class="level-header">
                            <h4>Consultant II</h4>
                            <div class="level-badge">Fast-Track Only</div>
                        </div>
                        <div class="level-content">
                            <div class="level-metrics">
                                <div class="metric-card">
                                    <div class="metric-label">Threshold</div>
                                    <div class="metric-value">£40,000</div>
                                </div>
                                <div class="metric-card">
                                    <div class="metric-label">Commission</div>
                                    <div class="metric-value">22.5%</div>
                                </div>
                            </div>
                            
                            <div class="promotion-paths" style="margin-top: 14px;">
                                <div class="promotion-section">
                                    <div class="promotion-title" style="font-size: 10px; font-weight: 600; color: #475569; margin-bottom: 6px; text-transform: uppercase; letter-spacing: 0.3px;">Promotion Path</div>
                                    <div class="promotion-list" style="display: flex; flex-direction: column; gap: 4px;">
                                        <div class="promotion-item" style="background: white; padding: 8px 10px; border-radius: 6px; border: 1px solid #e2e8f0; font-size: 11px; font-weight: 500; color: #64748b;">£96k → Senior (Early)</div>
                                        <div class="promotion-item" style="background: white; padding: 8px 10px; border-radius: 6px; border: 1px solid #e2e8f0; font-size: 11px; font-weight: 500; color: #64748b;">£120k → Principal (Early)</div>
                                        <div class="promotion-item" style="background: white; padding: 8px 10px; border-radius: 6px; border: 1px solid #e2e8f0; font-size: 11px; font-weight: 500; color: #64748b;">£160k → Senior</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="level-card senior">
                        <div class="level-header">
                            <h4>Senior Consultant</h4>
                            <div class="level-badge">Tiered Rates</div>
                        </div>
                        <div class="level-content">
                            <div class="level-metrics">
                                <div class="metric-card">
                                    <div class="metric-label">Threshold</div>
                                    <div class="metric-value">£40,000</div>
                                </div>
                                <div class="metric-card">
                                    <div class="metric-label">Max Rate</div>
                                    <div class="metric-value">30%</div>
                                </div>
                            </div>
                            
                            <div class="commission-info" style="margin-bottom: 14px;">
                                <div class="commission-tiers" style="background: #f8fafc; border-radius: 8px; padding: 12px; border: 1px solid #e2e8f0;">
                                    <div class="commission-tiers-title" style="font-size: 11px; font-weight: 600; color: #475569; margin-bottom: 8px; text-align: center; text-transform: uppercase; letter-spacing: 0.3px;">Commission Tiers</div>
                                    <div class="tier" style="display: flex; justify-content: space-between; align-items: center; padding: 6px 10px; margin-bottom: 4px; background: white; border-radius: 6px; border: 1px solid #e2e8f0;">
                                        <span class="tier-range" style="font-weight: 500; color: #64748b; font-size: 11px;">£40k-100k</span>
                                        <span class="tier-rate" style="font-weight: 700; color: #1e293b; font-size: 12px;">25%</span>
                                    </div>
                                    <div class="tier" style="display: flex; justify-content: space-between; align-items: center; padding: 6px 10px; background: white; border-radius: 6px; border: 1px solid #e2e8f0;">
                                        <span class="tier-range" style="font-weight: 500; color: #64748b; font-size: 11px;">£100k-200k</span>
                                        <span class="tier-rate" style="font-weight: 700; color: #1e293b; font-size: 12px;">30%</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="promotion-paths">
                                <div class="promotion-section">
                                    <div class="promotion-title" style="font-size: 10px; font-weight: 600; color: #475569; margin-bottom: 6px; text-transform: uppercase; letter-spacing: 0.3px;">To Principal</div>
                                    <div class="promotion-list" style="display: flex; flex-direction: column; gap: 4px;">
                                        <div class="promotion-item" style="background: white; padding: 8px 10px; border-radius: 6px; border: 1px solid #e2e8f0; font-size: 11px; font-weight: 500; color: #64748b;">£120k → Principal (Early)</div>
                                        <div class="promotion-item" style="background: white; padding: 8px 10px; border-radius: 6px; border: 1px solid #e2e8f0; font-size: 11px; font-weight: 500; color: #64748b;">£200k → Principal</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="level-card principal">
                        <div class="level-header">
                            <h4>Principal Consultant</h4>
                            <div class="level-badge">Top Tier</div>
                        </div>
                        <div class="level-content">
                            <div class="level-metrics">
                                <div class="metric-card">
                                    <div class="metric-label">Threshold</div>
                                    <div class="metric-value">£40,000</div>
                                </div>
                                <div class="metric-card">
                                    <div class="metric-label">Max Rate</div>
                                    <div class="metric-value">50%</div>
                                </div>
                            </div>
                            
                            <div class="commission-info" style="margin-bottom: 14px;">
                                <div class="commission-tiers" style="background: #f8fafc; border-radius: 8px; padding: 12px; border: 1px solid #e2e8f0;">
                                    <div class="commission-tiers-title" style="font-size: 11px; font-weight: 600; color: #475569; margin-bottom: 8px; text-align: center; text-transform: uppercase; letter-spacing: 0.3px;">Commission Tiers</div>
                                    <div class="tier" style="display: flex; justify-content: space-between; align-items: center; padding: 6px 10px; margin-bottom: 4px; background: white; border-radius: 6px; border: 1px solid #e2e8f0;">
                                        <span class="tier-range" style="font-weight: 500; color: #64748b; font-size: 11px;">£40k-100k</span>
                                        <span class="tier-rate" style="font-weight: 700; color: #1e293b; font-size: 12px;">25%</span>
                                    </div>
                                    <div class="tier" style="display: flex; justify-content: space-between; align-items: center; padding: 6px 10px; margin-bottom: 4px; background: white; border-radius: 6px; border: 1px solid #e2e8f0;">
                                        <span class="tier-range" style="font-weight: 500; color: #64748b; font-size: 11px;">£100k-200k</span>
                                        <span class="tier-rate" style="font-weight: 700; color: #1e293b; font-size: 12px;">30%</span>
                                    </div>
                                    <div class="tier" style="display: flex; justify-content: space-between; align-items: center; padding: 6px 10px; margin-bottom: 4px; background: white; border-radius: 6px; border: 1px solid #e2e8f0;">
                                        <span class="tier-range" style="font-weight: 500; color: #64748b; font-size: 11px;">£200k-300k</span>
                                        <span class="tier-rate" style="font-weight: 700; color: #1e293b; font-size: 12px;">35%</span>
                                    </div>
                                    <div class="tier" style="display: flex; justify-content: space-between; align-items: center; padding: 6px 10px; margin-bottom: 4px; background: white; border-radius: 6px; border: 1px solid #e2e8f0;">
                                        <span class="tier-range" style="font-weight: 500; color: #64748b; font-size: 11px;">£300k-400k</span>
                                        <span class="tier-rate" style="font-weight: 700; color: #1e293b; font-size: 12px;">40%</span>
                                    </div>
                                    <div class="tier highlight" style="display: flex; justify-content: space-between; align-items: center; padding: 6px 10px; background: linear-gradient(135deg, #fef3c7, #fde68a); border-radius: 6px; border: 1px solid #f59e0b;">
                                        <span class="tier-range" style="font-weight: 500; color: #92400e; font-size: 11px;">£400k+</span>
                                        <span class="tier-rate" style="font-weight: 700; color: #92400e; font-size: 12px;">50%</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="team-bonus" style="background: linear-gradient(135deg, #eff6ff, #dbeafe); border-radius: 8px; padding: 12px; margin-top: 14px; border: 1px solid #bfdbfe; text-align: center;">
                                <div class="team-bonus-title" style="font-size: 11px; font-weight: 600; color: #1e40af; margin-bottom: 6px; text-transform: uppercase; letter-spacing: 0.3px;">Team Bonus</div>
                                <div class="bonus-detail" style="display: flex; align-items: center; justify-content: center; gap: 6px;">
                                    <span class="bonus-rate" style="font-size: 16px; font-weight: 800; color: #1e40af;">10%</span>
                                    <span class="bonus-desc" style="font-size: 11px; color: #3b82f6; font-weight: 500;">of team billings</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="key-points" style="background: linear-gradient(135deg, #f8fafc, #f1f5f9); border-radius: 12px; padding: 20px; margin: 20px;">
                    <h4 style="color: #1e293b; font-size: 16px; font-weight: 700; margin-bottom: 16px; text-align: center;">Key Points</h4>
                    <div class="points-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 12px;">
                        <div class="point" style="display: flex; align-items: flex-start; gap: 12px; padding: 14px; background: white; border-radius: 8px; border: 1px solid #e2e8f0;">
                            <span class="point-icon" style="width: 6px; height: 6px; background: linear-gradient(135deg, #3b82f6, #1d4ed8); border-radius: 50%; flex-shrink: 0; margin-top: 4px;"></span>
                            <span style="font-size: 12px; color: #475569; line-height: 1.5; font-weight: 500;">Commission rates apply to billings above threshold</span>
                        </div>
                        <div class="point" style="display: flex; align-items: flex-start; gap: 12px; padding: 14px; background: white; border-radius: 8px; border: 1px solid #e2e8f0;">
                            <span class="point-icon" style="width: 6px; height: 6px; background: linear-gradient(135deg, #3b82f6, #1d4ed8); border-radius: 50%; flex-shrink: 0; margin-top: 4px;"></span>
                            <span style="font-size: 12px; color: #475569; line-height: 1.5; font-weight: 500;">Fast-track only for Consultants in Year 1</span>
                        </div>
                        <div class="point" style="display: flex; align-items: flex-start; gap: 12px; padding: 14px; background: white; border-radius: 8px; border: 1px solid #e2e8f0;">
                            <span class="point-icon" style="width: 6px; height: 6px; background: linear-gradient(135deg, #3b82f6, #1d4ed8); border-radius: 50%; flex-shrink: 0; margin-top: 4px;"></span>
                            <span style="font-size: 12px; color: #475569; line-height: 1.5; font-weight: 500;">Early promotions: 60% of target in first 6 months</span>
                        </div>
                        <div class="point" style="display: flex; align-items: flex-start; gap: 12px; padding: 14px; background: white; border-radius: 8px; border: 1px solid #e2e8f0;">
                            <span class="point-icon" style="width: 6px; height: 6px; background: linear-gradient(135deg, #3b82f6, #1d4ed8); border-radius: 50%; flex-shrink: 0; margin-top: 4px;"></span>
                            <span style="font-size: 12px; color: #475569; line-height: 1.5; font-weight: 500;">Commission year runs from your start date</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // State
        let billings = [];
        let billingIdCounter = 1;

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            bindEvents();
            updateDependentSections();
            updatePeriodSelector();
            updateCalculations();
        });

        function bindEvents() {
            document.getElementById('currentLevel').addEventListener('change', function() {
                updateDependentSections();
                updateCalculations();
            });

            document.getElementById('fastTrackToggle').addEventListener('change', function() {
                updatePeriodSelector();
                updateCalculations();
            });
            
            document.getElementById('baseSalary').addEventListener('input', updateCalculations);
            document.getElementById('teamBillings').addEventListener('input', updateCalculations);

            document.getElementById('billingValue').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') addBilling();
            });
        }

        function toggleBillings() {
            const panel = document.getElementById('billingsPanel');
            const arrow = document.getElementById('billingsArrow');
            const header = document.querySelector('.billing-header');
            
            panel.classList.toggle('open');
            arrow.classList.toggle('rotated');
            header.classList.toggle('active');
            
            updateBillingHeaderText();
        }

        function toggleLevels() {
            const panel = document.getElementById('levelsPanel');
            const arrow = document.getElementById('levelsArrow');
            const header = document.querySelector('.info-header');
            
            panel.classList.toggle('open');
            arrow.classList.toggle('rotated');
            header.classList.toggle('active');
        }

        function updateBillingHeaderText() {
            const headerText = document.querySelector('.billing-header span:first-child');
            const panel = document.getElementById('billingsPanel');
            
            if (!panel.classList.contains('open') && billings.length > 0) {
                headerText.textContent = `Billing Tracker (${billings.length})`;
            } else {
                headerText.textContent = 'Billing Tracker';
            }
        }

        function updatePeriodSelector() {
            const fastTrack = document.getElementById('fastTrackToggle').checked;
            const periodSelect = document.getElementById('billingPeriod');
            const periodContainer = periodSelect.closest('.period-select');
            const addBillingSection = document.querySelector('.add-billing-section');
            
            if (fastTrack) {
                // Hide period selector and default to "early" (Year 1)
                periodContainer.style.display = 'none';
                periodSelect.value = 'early'; // Default to early for Year 1
                addBillingSection.classList.add('fast-track');
            } else {
                // Show period selector
                periodContainer.style.display = '';
                addBillingSection.classList.remove('fast-track');
            }
        }

        function updateDependentSections() {
            const level = document.getElementById('currentLevel').value;
            const teamSection = document.getElementById('teamSection');
            
            if (level === 'Principal Consultant') {
                teamSection.classList.remove('hidden');
            } else {
                teamSection.classList.add('hidden');
            }
            
            const fastTrackToggle = document.getElementById('fastTrackToggle');
            const fastTrackContainer = fastTrackToggle.closest('.header-toggle');
            
            // Check if there are any "After 6 months" billings
            const hasLateBillings = billings.some(b => b.period === 'late');
            
            // Disable Fast-Track if not Consultant OR if there are "After 6 months" billings
            if (level !== 'Consultant' || hasLateBillings) {
                fastTrackContainer.classList.add('disabled');
                fastTrackToggle.checked = false;
                
                // Update tooltip to explain why it's disabled
                if (hasLateBillings) {
                    fastTrackContainer.setAttribute('data-tooltip', 'Fast-track not available with "After 6 months" billings (Year 2+)');
                } else {
                    fastTrackContainer.setAttribute('data-tooltip', 'Year 1 accelerated promotion path available for Consultants only');
                }
            } else {
                fastTrackContainer.classList.remove('disabled');
                fastTrackContainer.setAttribute('data-tooltip', 'Year 1 accelerated promotion path available for Consultants only');
            }
            
            // Update period selector visibility
            updatePeriodSelector();
        }

        function addBilling() {
            const valueInput = document.getElementById('billingValue');
            const periodSelect = document.getElementById('billingPeriod');
            const value = parseFloat(valueInput.value) || 0;
            
            if (value <= 0) return;
            
            billings.push({
                id: billingIdCounter++,
                value: value,
                period: periodSelect.value
            });
            
            valueInput.value = '';
            valueInput.focus();
            
            updateBillingsDisplay();
            updateDependentSections(); // Update Fast-Track availability
            updateCalculations();
        }

        function removeBilling(id) {
            billings = billings.filter(b => b.id !== id);
            updateBillingsDisplay();
            updateDependentSections(); // Update Fast-Track availability
            updateCalculations();
        }

        function updateBillingsDisplay() {
            const list = document.getElementById('billingsList');
            const summary = document.getElementById('billingsSummary');
            const fastTrack = document.getElementById('fastTrackToggle').checked;
            
            updateBillingHeaderText();
            
            if (billings.length === 0) {
                list.innerHTML = '';
                summary.classList.add('hidden');
                return;
            }
            
            const billingsWithCommission = billings.map((billing, index) => {
                const commission = calculateBillingCommission(billing, index);
                return { ...billing, commission };
            });
            
            list.innerHTML = billingsWithCommission.map((billing, index) => {
                // Determine period label based on Fast-Track mode
                let periodLabel = billing.period === 'early' ? 'First 6 months' : 'After 6 months';
                let periodClass = billing.period;
                
                if (fastTrack && billing.period === 'early') {
                    periodLabel = 'Year 1';
                }
                
                return `
                <div class="billing-item">
                    <div class="billing-info">
                        <span class="billing-number">Billing ${index + 1}</span>
                        <span class="billing-value">${formatCurrency(billing.value)}</span>
                        <span class="billing-period ${periodClass}">
                            ${periodLabel}
                        </span>
                        <span class="billing-commission">+${formatCurrency(billing.commission)}</span>
                    </div>
                    <button class="billing-remove" onclick="removeBilling(${billing.id})">×</button>
                </div>
            `}).join('');
            
            const totalValue = billings.reduce((sum, b) => sum + b.value, 0);
            const totalCommission = billingsWithCommission.reduce((sum, b) => sum + b.commission, 0);
            
            document.getElementById('totalBillings').textContent = billings.length;
            document.getElementById('totalBillingsValue').textContent = formatCurrency(totalValue);
            document.getElementById('totalCommission').textContent = formatCurrency(totalCommission);
            
            summary.classList.remove('hidden');
        }

        function calculateBillingCommission(billing, index) {
            const level = document.getElementById('currentLevel').value;
            const fastTrack = document.getElementById('fastTrackToggle').checked;
            
            let previousTotal = 0;
            for (let i = 0; i < index; i++) {
                previousTotal += billings[i].value;
            }
            
            const newTotal = previousTotal + billing.value;
            
            const prevCommission = calculateTotalCommission(previousTotal, level, fastTrack);
            const newCommission = calculateTotalCommission(newTotal, level, fastTrack);
            
            return newCommission.commission - prevCommission.commission;
        }

        function calculateTotalCommission(totalBillings, startLevel, fastTrack) {
            const threshold = startLevel === 'Consultant' ? 35000 : 40000;
            
            if (totalBillings <= threshold) {
                return { commission: 0, finalLevel: startLevel };
            }
            
            const commissionable = totalBillings - threshold;
            let commission = 0;
            let finalLevel = startLevel;
            
            // Check for early period billings
            const earlyBillings = billings
                .filter(b => b.period === 'early')
                .reduce((sum, b) => sum + b.value, 0);
            
            // Calculate commission based on level and promotion scenarios
            if (startLevel === 'Consultant') {
                if (fastTrack) {
                    // Fast-track logic
                    if (totalBillings >= 180000) {
                        commission = (65000 * 0.20) + (40000 * 0.225) + (40000 * 0.30) + ((commissionable - 145000) * 0.35);
                        finalLevel = 'Principal Consultant';
                    } else if (totalBillings >= 140000) {
                        commission = (65000 * 0.20) + (40000 * 0.225) + ((commissionable - 105000) * 0.30);
                        finalLevel = 'Senior Consultant';
                    } else if (totalBillings >= 100000) {
                        commission = (65000 * 0.20) + ((commissionable - 65000) * 0.225);
                        finalLevel = 'Consultant II';
                    } else {
                        commission = commissionable * 0.20;
                    }
                } else if (earlyBillings >= 120000) {
                    // Double early promotion: Consultant → Senior → Principal
                    finalLevel = 'Principal Consultant';
                    const consultantPortion = 61000; // £96k - £35k threshold
                    const seniorPortion = 24000;     // £120k - £96k
                    const principalPortion = Math.max(0, commissionable - 85000);
                    
                    // Consultant commission
                    commission = consultantPortion * 0.20;
                    
                    // Senior commission - properly handle tiers
                    const seniorFirstTier = Math.min(seniorPortion, 4000); // Up to £100k total
                    const seniorSecondTier = Math.max(0, seniorPortion - 4000);
                    commission += (seniorFirstTier * 0.25) + (seniorSecondTier * 0.30);
                    
                    // Principal commission - start at proper tier
                    if (principalPortion > 0) {
                        let remaining = principalPortion;
                        const inSecondTier = Math.min(remaining, 80000); // £120k-200k
                        commission += inSecondTier * 0.30;
                        remaining -= inSecondTier;
                        
                        if (remaining > 0) {
                            const inThirdTier = Math.min(remaining, 100000); // £200k-300k
                            commission += inThirdTier * 0.35;
                            remaining -= inThirdTier;
                        }
                        
                        if (remaining > 0) {
                            const inFourthTier = Math.min(remaining, 100000); // £300k-400k
                            commission += inFourthTier * 0.40;
                            remaining -= inFourthTier;
                        }
                        
                        if (remaining > 0) { // £400k+
                            commission += remaining * 0.50;
                        }
                    }
                } else if (earlyBillings >= 96000) {
                    // Single early promotion: Consultant → Senior
                    finalLevel = 'Senior Consultant';
                    const consultantPortion = 61000; // £96k - £35k threshold
                    const seniorPortion = Math.max(0, commissionable - 61000);
                    
                    // Consultant commission
                    commission = consultantPortion * 0.20;
                    
                    // Senior commission with proper tiers
                    if (seniorPortion > 0) {
                        const seniorFirstTier = Math.min(seniorPortion, 4000); // From £96k to £100k
                        const seniorSecondTier = Math.max(0, seniorPortion - 4000); // Above £100k
                        commission += (seniorFirstTier * 0.25) + (seniorSecondTier * 0.30);
                    }
                } else {
                    // No promotion
                    commission = commissionable * 0.20;
                }
            } else if (startLevel === 'Consultant II') {
                if (earlyBillings >= 120000) {
                    // Double early promotion to Principal
                    finalLevel = 'Principal Consultant';
                    const consultantIIPortion = 56000; // £96k - £40k threshold
                    const seniorPortion = 24000;       // £120k - £96k
                    const principalPortion = Math.max(0, commissionable - 80000);
                    
                    // Consultant II commission
                    commission = consultantIIPortion * 0.225;
                    
                    // Senior commission - handle the tiers properly
                    // Senior starts at £96k, first tier goes to £100k (60k above threshold), so we have 4k in first tier, 20k in second
                    const seniorFirstTier = Math.min(seniorPortion, 4000); // £96k to £100k is 4k in first tier
                    const seniorSecondTier = Math.max(0, seniorPortion - 4000); // Rest is in second tier
                    commission += (seniorFirstTier * 0.25) + (seniorSecondTier * 0.30);
                    
                    // Principal commission - starts at second tier (£120k-200k)
                    if (principalPortion > 0) {
                        let remaining = principalPortion;
                        const inSecondTier = Math.min(remaining, 80000); // £120k-200k
                        commission += inSecondTier * 0.30;
                        remaining -= inSecondTier;
                        
                        if (remaining > 0) {
                            const inThirdTier = Math.min(remaining, 100000); // £200k-300k
                            commission += inThirdTier * 0.35;
                            remaining -= inThirdTier;
                        }
                        
                        if (remaining > 0) {
                            const inFourthTier = Math.min(remaining, 100000); // £300k-400k
                            commission += inFourthTier * 0.40;
                            remaining -= inFourthTier;
                        }
                        
                        if (remaining > 0) { // £400k+
                            commission += remaining * 0.50;
                        }
                    }
                } else if (earlyBillings >= 96000) {
                    // Single early promotion to Senior
                    finalLevel = 'Senior Consultant';
                    const consultantIIPortion = 56000; // £96k - £40k threshold
                    const seniorPortion = Math.max(0, commissionable - 56000);
                    
                    // Consultant II commission
                    commission = consultantIIPortion * 0.225;
                    
                    // Senior commission with proper tiers
                    if (seniorPortion > 0) {
                        const seniorFirstTier = Math.min(seniorPortion, 4000); // From £96k to £100k
                        const seniorSecondTier = Math.max(0, seniorPortion - 4000); // Above £100k
                        commission += (seniorFirstTier * 0.25) + (seniorSecondTier * 0.30);
                    }
                } else {
                    // No promotion - standard Consultant II rate
                    commission = commissionable * 0.225;
                }
            } else if (startLevel === 'Senior Consultant') {
                if (earlyBillings >= 120000) {
                    // Early promotion to Principal
                    finalLevel = 'Principal Consultant';
                    const beforePromotion = Math.min(80000, commissionable); // Up to £120k (minus £40k threshold)
                    
                    // Senior rates up to promotion
                    if (beforePromotion <= 60000) {
                        commission = beforePromotion * 0.25;
                    } else {
                        commission = (60000 * 0.25) + ((beforePromotion - 60000) * 0.30);
                    }
                    
                    // Principal rates after promotion
                    const afterPromotion = commissionable - 80000;
                    if (afterPromotion > 0) {
                        let remaining = afterPromotion;
                        // Start at the £120k tier for Principal (second tier: £100k-200k)
                        const inSecondTier = Math.min(remaining, 80000); // Up to £200k total
                        commission += inSecondTier * 0.30;
                        remaining -= inSecondTier;
                        
                        if (remaining > 0) {
                            const inThirdTier = Math.min(remaining, 100000); // £200k-300k
                            commission += inThirdTier * 0.35;
                            remaining -= inThirdTier;
                        }
                        
                        if (remaining > 0) {
                            const inFourthTier = Math.min(remaining, 100000); // £300k-400k
                            commission += inFourthTier * 0.40;
                            remaining -= inFourthTier;
                        }
                        
                        if (remaining > 0) { // £400k+
                            commission += remaining * 0.50;
                        }
                    }
                } else {
                    // Standard Senior rates
                    if (commissionable <= 60000) {
                        commission = commissionable * 0.25;
                    } else {
                        commission = (60000 * 0.25) + ((commissionable - 60000) * 0.30);
                    }
                }
            } else if (startLevel === 'Principal Consultant') {
                // Principal tiers (no promotions from here)
                let remaining = commissionable;
                const tiers = [
                    { limit: 60000, rate: 0.25 },
                    { limit: 100000, rate: 0.30 },
                    { limit: 100000, rate: 0.35 },
                    { limit: 100000, rate: 0.40 },
                    { limit: Infinity, rate: 0.50 }
                ];
                
                for (const tier of tiers) {
                    const amount = Math.min(remaining, tier.limit);
                    commission += amount * tier.rate;
                    remaining -= amount;
                    if (remaining <= 0) break;
                }
            }
            
            return { commission, finalLevel };
        }

        function updateCalculations() {
            const totalBillings = billings.reduce((sum, b) => sum + b.value, 0);
            const startLevel = document.getElementById('currentLevel').value;
            const fastTrack = document.getElementById('fastTrackToggle').checked;
            const baseSalary = parseFloat(document.getElementById('baseSalary').value) || 0;
            const teamBillings = parseFloat(document.getElementById('teamBillings').value) || 0;
            
            const result = calculateTotalCommission(totalBillings, startLevel, fastTrack);
            const commission = result.commission;
            const currentLevel = result.finalLevel;
            const threshold = startLevel === 'Consultant' ? 35000 : 40000;
            
            // Update sticky header
            updateStickyHeader(totalBillings, commission, currentLevel);
            
            // Show/hide results
            const emptyState = document.getElementById('emptyState');
            const results = document.getElementById('calculationResults');
            
            if (totalBillings === 0 && baseSalary === 0 && teamBillings === 0) {
                emptyState.classList.remove('hidden');
                results.classList.add('hidden');
                return;
            }
            
            emptyState.classList.add('hidden');
            results.classList.remove('hidden');
            
            // Update threshold status
            const statusDiv = document.getElementById('thresholdStatus');
            const statusTitle = document.getElementById('statusTitle');
            const statusText = document.getElementById('statusText');
            
            if (totalBillings <= threshold) {
                statusDiv.className = 'status-compact error';
                statusTitle.textContent = 'Below Commission Threshold';
                statusText.textContent = `Need ${formatCurrency(threshold - totalBillings)} more to reach the ${formatCurrency(threshold)} threshold`;
            } else {
                statusDiv.className = 'status-compact success';
                statusTitle.textContent = 'Commission Threshold Met';
                statusText.textContent = `You've exceeded the ${formatCurrency(threshold)} threshold by ${formatCurrency(totalBillings - threshold)}`;
            }
            
            // Update breakdown
            updateBreakdown(totalBillings, startLevel, currentLevel, fastTrack);
            
            // Update earnings
            document.getElementById('commissionValue').textContent = formatCurrency(commission);
            
            const salaryRow = document.getElementById('salaryRow');
            if (baseSalary > 0) {
                salaryRow.classList.remove('hidden');
                document.getElementById('salaryValue').textContent = formatCurrency(baseSalary);
            } else {
                salaryRow.classList.add('hidden');
            }
            
            const teamBonus = (currentLevel === 'Principal Consultant' || startLevel === 'Principal Consultant') ? teamBillings * 0.10 : 0;
            const teamRow = document.getElementById('teamBonusRow');
            if (teamBonus > 0) {
                teamRow.classList.remove('hidden');
                document.getElementById('teamBonusValue').textContent = formatCurrency(teamBonus);
            } else {
                teamRow.classList.add('hidden');
            }
            
            const total = commission + baseSalary + teamBonus;
            const totalRow = document.getElementById('totalRow');
            if (baseSalary > 0 || teamBonus > 0) {
                totalRow.classList.remove('hidden');
                document.getElementById('totalEarningsValue').textContent = formatCurrency(total);
            } else {
                totalRow.classList.add('hidden');
            }
            
            // Update promotion progress
            updatePromotionProgress(totalBillings, startLevel, currentLevel, fastTrack);
            
            // Show promotion achieved badge if applicable
            const earlyBillings = billings
                .filter(b => b.period === 'early')
                .reduce((sum, b) => sum + b.value, 0);
            
            // Check if early promotion was achieved
            let promotionAchieved = false;
            let promotionMessage = '';
            
            if (startLevel === 'Consultant' && earlyBillings >= 120000) {
                promotionAchieved = true;
                promotionMessage = 'Double Early Promotion: Consultant → Senior → Principal';
            } else if (startLevel === 'Consultant' && earlyBillings >= 96000) {
                promotionAchieved = true;
                promotionMessage = 'Early Promotion: Consultant → Senior';
            } else if (startLevel === 'Consultant II' && earlyBillings >= 120000) {
                promotionAchieved = true;
                promotionMessage = 'Double Early Promotion: Consultant II → Senior → Principal';
            } else if (startLevel === 'Consultant II' && earlyBillings >= 96000) {
                promotionAchieved = true;
                promotionMessage = 'Early Promotion: Consultant II → Senior';
            } else if (startLevel === 'Senior Consultant' && earlyBillings >= 120000) {
                promotionAchieved = true;
                promotionMessage = 'Early Promotion: Senior → Principal';
            }
            
            // Remove any existing badge first
            const existingBadge = document.querySelector('.promotion-achieved-badge');
            if (existingBadge) {
                existingBadge.remove();
            }
            
            // Add promotion badge if achieved
            if (promotionAchieved && currentLevel !== startLevel) {
                const breakdownDiv = document.getElementById('breakdown');
                
                if (breakdownDiv) {
                    const badge = document.createElement('div');
                    badge.className = 'promotion-achieved-badge';
                    badge.style.cssText = `
                        background: #f0fdf4;
                        color: #166534;
                        padding: 12px 16px;
                        border-radius: 6px;
                        margin-bottom: 16px;
                        border: 1px solid #bbf7d0;
                        font-weight: 500;
                        font-size: 13px;
                        display: flex;
                        align-items: center;
                        gap: 8px;
                        animation: slideIn 0.4s ease;
                    `;
                    badge.innerHTML = `
                        <span style="background: #dcfce7; padding: 2px 6px; border-radius: 10px; font-size: 10px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">Early Promotion</span>
                        <span>${promotionMessage}</span>
                    `;
                    breakdownDiv.parentNode.insertBefore(badge, breakdownDiv);
                }
            }
        }

        function updateBreakdown(totalBillings, startLevel, currentLevel, fastTrack) {
            const breakdown = document.getElementById('breakdown');
            const items = document.getElementById('breakdownItems');
            const threshold = startLevel === 'Consultant' ? 35000 : 40000;
            
            if (totalBillings <= threshold) {
                breakdown.classList.add('hidden');
                return;
            }
            
            breakdown.classList.remove('hidden');
            
            const commissionable = totalBillings - threshold;
            let html = '';
            
            // Check for early period billings
            const earlyBillings = billings
                .filter(b => b.period === 'early')
                .reduce((sum, b) => sum + b.value, 0);
            
            // Build breakdown based on level and promotions
            if (startLevel === 'Senior Consultant' && earlyBillings >= 120000) {
                // Early promotion to Principal
                const beforePromotion = Math.min(80000, commissionable);
                
                // Senior rates up to promotion
                if (beforePromotion <= 60000) {
                    html += `
                        <div class="breakdown-item">
                            <span class="breakdown-left">Senior Consultant (25%): ${formatCurrency(beforePromotion)}</span>
                            <span class="breakdown-right">${formatCurrency(beforePromotion * 0.25)}</span>
                        </div>
                    `;
                } else {
                    html += `
                        <div class="breakdown-item">
                            <span class="breakdown-left">Senior Consultant (25%): £60,000</span>
                            <span class="breakdown-right">£15,000</span>
                        </div>
                        <div class="breakdown-item">
                            <span class="breakdown-left">Senior Consultant (30%): ${formatCurrency(beforePromotion - 60000)}</span>
                            <span class="breakdown-right">${formatCurrency((beforePromotion - 60000) * 0.30)}</span>
                        </div>
                    `;
                }
                
                // Show promotion indicator
                const afterPromotion = commissionable - 80000;
                if (afterPromotion > 0) {
                    html += `
                        <div class="breakdown-promotion-divider">
                            <div class="promotion-indicator">Early promotion at £120,000</div>
                        </div>
                    `;
                    
                    // Principal rates after promotion
                    let remaining = afterPromotion;
                    const inSecondTier = Math.min(remaining, 80000);
                    html += `
                        <div class="breakdown-item">
                            <span class="breakdown-left">Principal Consultant (30%): ${formatCurrency(inSecondTier)}</span>
                            <span class="breakdown-right">${formatCurrency(inSecondTier * 0.30)}</span>
                        </div>
                    `;
                    remaining -= inSecondTier;
                    
                    if (remaining > 0) {
                        const inThirdTier = Math.min(remaining, 100000);
                        html += `
                            <div class="breakdown-item">
                                <span class="breakdown-left">Principal Consultant (35%): ${formatCurrency(inThirdTier)}</span>
                                <span class="breakdown-right">${formatCurrency(inThirdTier * 0.35)}</span>
                            </div>
                        `;
                        remaining -= inThirdTier;
                    }
                    
                    if (remaining > 0) {
                        const inFourthTier = Math.min(remaining, 100000);
                        html += `
                            <div class="breakdown-item">
                                <span class="breakdown-left">Principal Consultant (40%): ${formatCurrency(inFourthTier)}</span>
                                <span class="breakdown-right">${formatCurrency(inFourthTier * 0.40)}</span>
                            </div>
                        `;
                        remaining -= inFourthTier;
                    }
                    
                    if (remaining > 0) {
                        html += `
                            <div class="breakdown-item">
                                <span class="breakdown-left">Principal Consultant (50%): ${formatCurrency(remaining)}</span>
                                <span class="breakdown-right">${formatCurrency(remaining * 0.50)}</span>
                            </div>
                        `;
                    }
                }
            } else if (startLevel === 'Consultant II' && earlyBillings >= 96000) {
                // Early promotion to Senior (or Principal)
                const beforePromotion = Math.min(56000, commissionable);
                html += `
                    <div class="breakdown-item">
                        <span class="breakdown-left">Consultant II (22.5%): ${formatCurrency(beforePromotion)}</span>
                        <span class="breakdown-right">${formatCurrency(beforePromotion * 0.225)}</span>
                    </div>
                `;
                
                if (earlyBillings >= 120000) {
                    // Double promotion
                    const seniorPortion = 24000; // £120k - £96k
                    
                    if (seniorPortion > 0) {
                        html += `
                            <div class="breakdown-promotion-divider">
                                <div class="promotion-indicator">Early promotion at £96,000</div>
                            </div>
                        `;
                        
                        const seniorFirstTier = Math.min(seniorPortion, 4000);
                        const seniorSecondTier = Math.max(0, seniorPortion - 4000);
                        
                        if (seniorFirstTier > 0) {
                            html += `
                                <div class="breakdown-item">
                                    <span class="breakdown-left">Senior Consultant (25%): ${formatCurrency(seniorFirstTier)}</span>
                                    <span class="breakdown-right">${formatCurrency(seniorFirstTier * 0.25)}</span>
                                </div>
                            `;
                        }
                        
                        if (seniorSecondTier > 0) {
                            html += `
                                <div class="breakdown-item">
                                    <span class="breakdown-left">Senior Consultant (30%): ${formatCurrency(seniorSecondTier)}</span>
                                    <span class="breakdown-right">${formatCurrency(seniorSecondTier * 0.30)}</span>
                                </div>
                            `;
                        }
                    }
                    
                    const principalPortion = Math.max(0, commissionable - 80000);
                    if (principalPortion > 0) {
                        html += `
                            <div class="breakdown-promotion-divider">
                                <div class="promotion-indicator">Early promotion at £120,000</div>
                            </div>
                        `;
                        
                        let remaining = principalPortion;
                        const inSecondTier = Math.min(remaining, 80000);
                        html += `
                            <div class="breakdown-item">
                                <span class="breakdown-left">Principal Consultant (30%): ${formatCurrency(inSecondTier)}</span>
                                <span class="breakdown-right">${formatCurrency(inSecondTier * 0.30)}</span>
                            </div>
                        `;
                        remaining -= inSecondTier;
                        
                        if (remaining > 0) {
                            const inThirdTier = Math.min(remaining, 100000);
                            html += `
                                <div class="breakdown-item">
                                    <span class="breakdown-left">Principal Consultant (35%): ${formatCurrency(inThirdTier)}</span>
                                    <span class="breakdown-right">${formatCurrency(inThirdTier * 0.35)}</span>
                                </div>
                            `;
                            remaining -= inThirdTier;
                        }
                        
                        if (remaining > 0) {
                            const inFourthTier = Math.min(remaining, 100000);
                            html += `
                                <div class="breakdown-item">
                                    <span class="breakdown-left">Principal Consultant (40%): ${formatCurrency(inFourthTier)}</span>
                                    <span class="breakdown-right">${formatCurrency(inFourthTier * 0.40)}</span>
                                </div>
                            `;
                            remaining -= inFourthTier;
                        }
                        
                        if (remaining > 0) {
                            html += `
                                <div class="breakdown-item">
                                    <span class="breakdown-left">Principal Consultant (50%): ${formatCurrency(remaining)}</span>
                                    <span class="breakdown-right">${formatCurrency(remaining * 0.50)}</span>
                                </div>
                            `;
                        }
                    }
                } else {
                    // Single promotion to Senior only
                    const afterPromotion = commissionable - 56000;
                    if (afterPromotion > 0) {
                        html += `
                            <div class="breakdown-promotion-divider">
                                <div class="promotion-indicator">Early promotion at £96,000</div>
                            </div>
                        `;
                        
                        const seniorFirstTier = Math.min(afterPromotion, 4000);
                        const seniorSecondTier = Math.max(0, afterPromotion - 4000);
                        
                        if (seniorFirstTier > 0) {
                            html += `
                                <div class="breakdown-item">
                                    <span class="breakdown-left">Senior Consultant (25%): ${formatCurrency(seniorFirstTier)}</span>
                                    <span class="breakdown-right">${formatCurrency(seniorFirstTier * 0.25)}</span>
                                </div>
                            `;
                        }
                        
                        if (seniorSecondTier > 0) {
                            html += `
                                <div class="breakdown-item">
                                    <span class="breakdown-left">Senior Consultant (30%): ${formatCurrency(seniorSecondTier)}</span>
                                    <span class="breakdown-right">${formatCurrency(seniorSecondTier * 0.30)}</span>
                                </div>
                            `;
                        }
                    }
                }
            } else {
                // Handle other cases with the existing logic
                if (startLevel === 'Consultant') {
                    if (fastTrack) {
                        // Fast-track breakdown
                        if (totalBillings >= 180000) {
                            html += `
                                <div class="breakdown-item">
                                    <span class="breakdown-left">Consultant (20%): £65,000</span>
                                    <span class="breakdown-right">£13,000</span>
                                </div>
                            `;
                            html += `
                                <div class="breakdown-promotion-divider">
                                    <div class="promotion-indicator">Promoted at £100,000</div>
                                </div>
                            `;
                            html += `
                                <div class="breakdown-item">
                                    <span class="breakdown-left">Consultant II (22.5%): £40,000</span>
                                    <span class="breakdown-right">£9,000</span>
                                </div>
                            `;
                            html += `
                                <div class="breakdown-promotion-divider">
                                    <div class="promotion-indicator">Promoted at £140,000</div>
                                </div>
                            `;
                            html += `
                                <div class="breakdown-item">
                                    <span class="breakdown-left">Senior Consultant (30%): £40,000</span>
                                    <span class="breakdown-right">£12,000</span>
                                </div>
                            `;
                            html += `
                                <div class="breakdown-promotion-divider">
                                    <div class="promotion-indicator">Promoted at £180,000</div>
                                </div>
                            `;
                            const principalBillings = commissionable - 145000;
                            const principalCommission = principalBillings * 0.35;
                            html += `
                                <div class="breakdown-item">
                                    <span class="breakdown-left">Principal Consultant (35%): ${formatCurrency(principalBillings)}</span>
                                    <span class="breakdown-right">${formatCurrency(principalCommission)}</span>
                                </div>
                            `;
                        } else if (totalBillings >= 140000) {
                            html += `
                                <div class="breakdown-item">
                                    <span class="breakdown-left">Consultant (20%): £65,000</span>
                                    <span class="breakdown-right">£13,000</span>
                                </div>
                            `;
                            html += `
                                <div class="breakdown-promotion-divider">
                                    <div class="promotion-indicator">Promoted at £100,000</div>
                                </div>
                            `;
                            html += `
                                <div class="breakdown-item">
                                    <span class="breakdown-left">Consultant II (22.5%): £40,000</span>
                                    <span class="breakdown-right">£9,000</span>
                                </div>
                            `;
                            html += `
                                <div class="breakdown-promotion-divider">
                                    <div class="promotion-indicator">Promoted at £140,000</div>
                                </div>
                            `;
                            const seniorBillings = commissionable - 105000;
                            const seniorCommission = seniorBillings * 0.30;
                            html += `
                                <div class="breakdown-item">
                                    <span class="breakdown-left">Senior Consultant (30%): ${formatCurrency(seniorBillings)}</span>
                                    <span class="breakdown-right">${formatCurrency(seniorCommission)}</span>
                                </div>
                            `;
                        } else if (totalBillings >= 100000) {
                            html += `
                                <div class="breakdown-item">
                                    <span class="breakdown-left">Consultant (20%): £65,000</span>
                                    <span class="breakdown-right">£13,000</span>
                                </div>
                            `;
                            html += `
                                <div class="breakdown-promotion-divider">
                                    <div class="promotion-indicator">Promoted at £100,000</div>
                                </div>
                            `;
                            const consultantIIBillings = commissionable - 65000;
                            const consultantIICommission = consultantIIBillings * 0.225;
                            html += `
                                <div class="breakdown-item">
                                    <span class="breakdown-left">Consultant II (22.5%): ${formatCurrency(consultantIIBillings)}</span>
                                    <span class="breakdown-right">${formatCurrency(consultantIICommission)}</span>
                                </div>
                            `;
                        } else {
                            html += `
                                <div class="breakdown-item">
                                    <span class="breakdown-left">Consultant (20%): ${formatCurrency(commissionable)}</span>
                                    <span class="breakdown-right">${formatCurrency(commissionable * 0.20)}</span>
                                </div>
                            `;
                        }
                    } else if (earlyBillings >= 120000) {
                        // Double early promotion: Consultant → Senior → Principal
                        const consultantPortion = 61000; // £96k - £35k threshold
                        const seniorPortion = 24000;     // £120k - £96k
                        const principalPortion = Math.max(0, commissionable - 85000);
                        
                        html += `
                            <div class="breakdown-item">
                                <span class="breakdown-left">Consultant (20%): ${formatCurrency(consultantPortion)}</span>
                                <span class="breakdown-right">${formatCurrency(consultantPortion * 0.20)}</span>
                            </div>
                        `;
                        
                        html += `
                            <div class="breakdown-promotion-divider">
                                <div class="promotion-indicator">Early promotion at £96,000</div>
                            </div>
                        `;
                        
                        // Senior portion breakdown - fixed calculation
                        const seniorFirstTier = Math.min(seniorPortion, 4000); // £96k to £100k is 4k
                        const seniorSecondTier = Math.max(0, seniorPortion - 4000); // Rest in second tier
                        
                        if (seniorFirstTier > 0) {
                            html += `
                                <div class="breakdown-item">
                                    <span class="breakdown-left">Senior Consultant (25%): ${formatCurrency(seniorFirstTier)}</span>
                                    <span class="breakdown-right">${formatCurrency(seniorFirstTier * 0.25)}</span>
                                </div>
                            `;
                        }
                        
                        if (seniorSecondTier > 0) {
                            html += `
                                <div class="breakdown-item">
                                    <span class="breakdown-left">Senior Consultant (30%): ${formatCurrency(seniorSecondTier)}</span>
                                    <span class="breakdown-right">${formatCurrency(seniorSecondTier * 0.30)}</span>
                                </div>
                            `;
                        }
                        
                        if (principalPortion > 0) {
                            html += `
                                <div class="breakdown-promotion-divider">
                                    <div class="promotion-indicator">Early promotion at £120,000</div>
                                </div>
                            `;
                            
                            let remaining = principalPortion;
                            const inSecondTier = Math.min(remaining, 80000);
                            if (inSecondTier > 0) {
                                html += `
                                    <div class="breakdown-item">
                                        <span class="breakdown-left">Principal Consultant (30%): ${formatCurrency(inSecondTier)}</span>
                                        <span class="breakdown-right">${formatCurrency(inSecondTier * 0.30)}</span>
                                    </div>
                                `;
                                remaining -= inSecondTier;
                            }
                            
                            if (remaining > 0) {
                                const inThirdTier = Math.min(remaining, 100000);
                                html += `
                                    <div class="breakdown-item">
                                        <span class="breakdown-left">Principal Consultant (35%): ${formatCurrency(inThirdTier)}</span>
                                        <span class="breakdown-right">${formatCurrency(inThirdTier * 0.35)}</span>
                                    </div>
                                `;
                                remaining -= inThirdTier;
                            }
                            
                            if (remaining > 0) {
                                const inFourthTier = Math.min(remaining, 100000);
                                html += `
                                    <div class="breakdown-item">
                                        <span class="breakdown-left">Principal Consultant (40%): ${formatCurrency(inFourthTier)}</span>
                                        <span class="breakdown-right">${formatCurrency(inFourthTier * 0.40)}</span>
                                    </div>
                                `;
                                remaining -= inFourthTier;
                            }
                            
                            if (remaining > 0) {
                                html += `
                                    <div class="breakdown-item">
                                        <span class="breakdown-left">Principal Consultant (50%): ${formatCurrency(remaining)}</span>
                                        <span class="breakdown-right">${formatCurrency(remaining * 0.50)}</span>
                                    </div>
                                `;
                            }
                        }
                    } else if (earlyBillings >= 96000) {
                        // Single early promotion: Consultant → Senior
                        const consultantPortion = 61000; // £96k - £35k threshold  
                        const seniorPortion = Math.max(0, commissionable - 61000);
                        
                        html += `
                            <div class="breakdown-item">
                                <span class="breakdown-left">Consultant (20%): ${formatCurrency(consultantPortion)}</span>
                                <span class="breakdown-right">${formatCurrency(consultantPortion * 0.20)}</span>
                            </div>
                        `;
                        
                        if (seniorPortion > 0) {
                            html += `
                                <div class="breakdown-promotion-divider">
                                    <div class="promotion-indicator">Early promotion at £96,000</div>
                                </div>
                            `;
                            
                            const seniorFirstTier = Math.min(seniorPortion, 4000); // £96k to £100k
                            const seniorSecondTier = Math.max(0, seniorPortion - 4000); // Above £100k
                            
                            if (seniorFirstTier > 0) {
                                html += `
                                    <div class="breakdown-item">
                                        <span class="breakdown-left">Senior Consultant (25%): ${formatCurrency(seniorFirstTier)}</span>
                                        <span class="breakdown-right">${formatCurrency(seniorFirstTier * 0.25)}</span>
                                    </div>
                                `;
                            }
                            
                            if (seniorSecondTier > 0) {
                                html += `
                                    <div class="breakdown-item">
                                        <span class="breakdown-left">Senior Consultant (30%): ${formatCurrency(seniorSecondTier)}</span>
                                        <span class="breakdown-right">${formatCurrency(seniorSecondTier * 0.30)}</span>
                                    </div>
                                `;
                            }
                        }
                    } else {
                        html += `
                            <div class="breakdown-item">
                                <span class="breakdown-left">Consultant (20%): ${formatCurrency(commissionable)}</span>
                                <span class="breakdown-right">${formatCurrency(commissionable * 0.20)}</span>
                            </div>
                        `;
                    }
                } else if (startLevel === 'Consultant II' && earlyBillings < 96000) {
                    // No promotion for Consultant II
                    html += `
                        <div class="breakdown-item">
                            <span class="breakdown-left">Consultant II (22.5%): ${formatCurrency(commissionable)}</span>
                            <span class="breakdown-right">${formatCurrency(commissionable * 0.225)}</span>
                        </div>
                    `;
                } else if (startLevel === 'Senior Consultant' && earlyBillings < 120000) {
                    // Standard Senior rates
                    if (commissionable <= 60000) {
                        html += `
                            <div class="breakdown-item">
                                <span class="breakdown-left">Senior Consultant (25%): ${formatCurrency(commissionable)}</span>
                                <span class="breakdown-right">${formatCurrency(commissionable * 0.25)}</span>
                            </div>
                        `;
                    } else {
                        html += `
                            <div class="breakdown-item">
                                <span class="breakdown-left">Senior Consultant (25%): £60,000</span>
                                <span class="breakdown-right">£15,000</span>
                            </div>
                            <div class="breakdown-item">
                                <span class="breakdown-left">Senior Consultant (30%): ${formatCurrency(commissionable - 60000)}</span>
                                <span class="breakdown-right">${formatCurrency((commissionable - 60000) * 0.30)}</span>
                            </div>
                        `;
                    }
                } else if (startLevel === 'Principal Consultant') {
                    let remaining = commissionable;
                    
                    if (remaining > 0) {
                        const tier1 = Math.min(remaining, 60000);
                        html += `
                            <div class="breakdown-item">
                                <span class="breakdown-left">Principal Consultant (25%): ${formatCurrency(tier1)}</span>
                                <span class="breakdown-right">${formatCurrency(tier1 * 0.25)}</span>
                            </div>
                        `;
                        remaining -= tier1;
                    }
                    
                    if (remaining > 0) {
                        const tier2 = Math.min(remaining, 100000);
                        html += `
                            <div class="breakdown-item">
                                <span class="breakdown-left">Principal Consultant (30%): ${formatCurrency(tier2)}</span>
                                <span class="breakdown-right">${formatCurrency(tier2 * 0.30)}</span>
                            </div>
                        `;
                        remaining -= tier2;
                    }
                    
                    if (remaining > 0) {
                        const tier3 = Math.min(remaining, 100000);
                        html += `
                            <div class="breakdown-item">
                                <span class="breakdown-left">Principal Consultant (35%): ${formatCurrency(tier3)}</span>
                                <span class="breakdown-right">${formatCurrency(tier3 * 0.35)}</span>
                            </div>
                        `;
                        remaining -= tier3;
                    }
                    
                    if (remaining > 0) {
                        const tier4 = Math.min(remaining, 100000);
                        html += `
                            <div class="breakdown-item">
                                <span class="breakdown-left">Principal Consultant (40%): ${formatCurrency(tier4)}</span>
                                <span class="breakdown-right">${formatCurrency(tier4 * 0.40)}</span>
                            </div>
                        `;
                        remaining -= tier4;
                    }
                    
                    if (remaining > 0) {
                        html += `
                            <div class="breakdown-item">
                                <span class="breakdown-left">Principal Consultant (50%): ${formatCurrency(remaining)}</span>
                                <span class="breakdown-right">${formatCurrency(remaining * 0.50)}</span>
                            </div>
                        `;
                    }
                }
            }
            
            items.innerHTML = html;
        }

        function updatePromotionProgress(totalBillings, startLevel, currentLevel, fastTrack) {
            const progressDiv = document.getElementById('promotionProgress');
            const progressContent = document.getElementById('promotionContent');
            
            if (currentLevel === 'Principal Consultant') {
                progressDiv.classList.add('hidden');
                return;
            }
            
            progressDiv.classList.remove('hidden');
            
            // Calculate early billings
            const earlyBillings = billings
                .filter(b => b.period === 'early')
                .reduce((sum, b) => sum + b.value, 0);
            
            let html = '';
            
            // Determine promotion targets based on starting level
            if (fastTrack && startLevel === 'Consultant' && currentLevel === startLevel) {
                // Fast-track mode - only show if still at starting level
                let nextTarget, targetAmount;
                if (totalBillings < 100000) {
                    nextTarget = 'Consultant II';
                    targetAmount = 100000;
                } else if (totalBillings < 140000) {
                    nextTarget = 'Senior Consultant';
                    targetAmount = 140000;
                } else if (totalBillings < 180000) {
                    nextTarget = 'Principal Consultant';
                    targetAmount = 180000;
                }
                
                if (nextTarget) {
                    const progress = (totalBillings / targetAmount) * 100;
                    const remaining = targetAmount - totalBillings;
                    
                    html = `
                        <div class="progress-container">
                            <div class="progress-header">
                                <span class="progress-label">Fast-Track to ${nextTarget}</span>
                                <span class="progress-type">${Math.round(progress)}%</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${Math.min(progress, 100)}%"></div>
                            </div>
                            <div class="progress-stats">
                                <span>Current: ${formatCurrency(totalBillings)}</span>
                                <span>Target: ${formatCurrency(targetAmount)}</span>
                            </div>
                        </div>
                    `;
                }
            } else {
                // Standard mode OR fast-track after promotion - show regular promotion paths
                let standardTarget, standardAmount, earlyTarget, earlyAmount;
                
                if (currentLevel === 'Consultant') {
                    standardTarget = 'Senior Consultant';
                    standardAmount = 160000;
                    
                    // Show both promotion paths for Consultants
                    if (earlyBillings < 96000) {
                        earlyTarget = 'Senior Consultant';
                        earlyAmount = 96000;
                    } else if (earlyBillings < 120000) {
                        earlyTarget = 'Principal Consultant';
                        earlyAmount = 120000;
                    }
                } else if (currentLevel === 'Consultant II') {
                    standardTarget = 'Senior Consultant';
                    standardAmount = 160000;
                    
                    // Show both promotion paths for Consultant II
                    if (earlyBillings < 96000) {
                        earlyTarget = 'Senior Consultant';
                        earlyAmount = 96000;
                    } else if (earlyBillings < 120000) {
                        earlyTarget = 'Principal Consultant';
                        earlyAmount = 120000;
                    }
                } else if (currentLevel === 'Senior Consultant') {
                    standardTarget = 'Principal Consultant';
                    standardAmount = 200000;
                    if (earlyBillings < 120000) {
                        earlyTarget = 'Principal Consultant';
                        earlyAmount = 120000;
                    }
                } else if (currentLevel === 'Principal Consultant') {
                    // No more promotions available
                    standardTarget = null;
                }
                
                // Show progress based on current level, not starting level
                if (earlyBillings > 0 && earlyTarget && earlyBillings < earlyAmount) {
                    // Show early promotion progress
                    const earlyProgress = (earlyBillings / earlyAmount) * 100;
                    
                    html = `
                        <div style="display: grid; gap: 14px;">
                            <!-- Early Promotion Path -->
                            <div class="progress-container">
                                <div class="progress-header">
                                    <span class="progress-label">
                                        <span style="display: inline-block; background: #dcfce7; color: #166534; font-size: 9px; padding: 2px 6px; border-radius: 10px; text-transform: uppercase; letter-spacing: 0.5px; font-weight: 600; margin-right: 6px;">EARLY</span>
                                        ${earlyTarget}
                                    </span>
                                    <span class="progress-type">${Math.round(earlyProgress)}%</span>
                                </div>
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: ${Math.min(earlyProgress, 100)}%; background: #22c55e;"></div>
                                </div>
                                <div class="progress-stats">
                                    <span>First 6mo: ${formatCurrency(earlyBillings)}</span>
                                    <span>Target: ${formatCurrency(earlyAmount)}</span>
                                </div>
                            </div>
                    `;
                    
                    // If there's also a standard target to show
                    if (standardTarget) {
                        const standardProgress = (totalBillings / standardAmount) * 100;
                        html += `
                            <!-- Standard Promotion Path -->
                            <div class="progress-container" style="opacity: 0.6;">
                                <div class="progress-header">
                                    <span class="progress-label">${standardTarget}</span>
                                    <span class="progress-type">${Math.round(standardProgress)}%</span>
                                </div>
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: ${Math.min(standardProgress, 100)}%;"></div>
                                </div>
                                <div class="progress-stats">
                                    <span>Total: ${formatCurrency(totalBillings)}</span>
                                    <span>Target: ${formatCurrency(standardAmount)}</span>
                                </div>
                            </div>
                        `;
                    }
                    
                    html += `</div>`;
                } else if (standardTarget) {
                    // Show single standard progress if no early billings or early promotion achieved/missed
                    const progress = (totalBillings / standardAmount) * 100;
                    const remaining = standardAmount - totalBillings;
                    
                    html = `
                        <div class="progress-container">
                            <div class="progress-header">
                                <span class="progress-label">Next: ${standardTarget}</span>
                                <span class="progress-type">${Math.round(progress)}%</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${Math.min(progress, 100)}%"></div>
                            </div>
                            <div class="progress-stats">
                                <span>Current: ${formatCurrency(totalBillings)}</span>
                                <span>Target: ${formatCurrency(standardAmount)}</span>
                            </div>
                        </div>
                    `;
                }
            }
            
            progressContent.innerHTML = html || '';
        }

        function updateStickyHeader(totalBillings, commission, currentLevel) {
            document.getElementById('stickyBillings').textContent = formatCurrency(totalBillings);
            document.getElementById('stickyCommission').textContent = formatCurrency(commission);
            document.getElementById('stickySeniority').textContent = formatLevel(currentLevel);
            
            const seniorityMetric = document.querySelector('.sticky-metric.seniority');
            seniorityMetric.classList.remove('consultant', 'consultant-ii', 'senior', 'principal');
            
            const levelClass = currentLevel.toLowerCase().replace(/\s+/g, '-');
            if (levelClass === 'consultant-ii') {
                seniorityMetric.classList.add('consultant-ii');
            } else if (levelClass === 'senior-consultant') {
                seniorityMetric.classList.add('senior');
            } else if (levelClass === 'principal-consultant') {
                seniorityMetric.classList.add('principal');
            } else {
                seniorityMetric.classList.add('consultant');
            }
        }

        function formatCurrency(amount) {
            return new Intl.NumberFormat('en-GB', {
                style: 'currency',
                currency: 'GBP',
                minimumFractionDigits: 0,
                maximumFractionDigits: 0
            }).format(Math.round(amount));
        }

        function formatLevel(level) {
            const map = {
                'Consultant': 'Consultant',
                'Consultant II': 'Consultant II',
                'Senior Consultant': 'Senior',
                'Principal Consultant': 'Principal'
            };
            return map[level] || level;
        }

        // Global functions
        window.addBilling = addBilling;
        window.removeBilling = removeBilling;
        window.toggleBillings = toggleBillings;
        window.toggleLevels = toggleLevels;
    </script>
</body>
</html>
